<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dangjia.acg.mapper.order.IBillChangeOrderMapper">

    <!--查询退款历史记录-->
     <select id="queryReturnWorkerList" resultType="com.dangjia.acg.dto.refund.ReturnWorkOrderDTO">
         SELECT
            t1.id repairWorkOrderId,
            t1.title_name repairWorkOrderName,
            t1.create_date applyDate,
            t1.house_id houseId,
            CONCAT(t1.content_a,t1.content_b) content,
            t1.worker_type_id workTypeId,
            t1.state,
            t2.`name` workTypeName,
            t3.worker_id workerId ,
            t4.`name` workerName,
            t4.mobile workerMobile
        FROM
            dj_repair_change_order t1,
            dj_core_worker_type t2,
            dj_core_house_worker_order t3  ,
            dj_member t4
        where t1.worker_type_id=t2.id
        and t1.house_id=t3.house_id
        and t1.worker_type_id=t3.worker_type_id
        and t3.worker_id = t4.id
        and t1.house_id=#{houseId}
        and t1.data_status = '0'
        <if test="type==1">
            and t1.type=#{type}
            and t1.worker_id=#{memberId}
        </if>
         <if test="type==2">
             and t1.type=#{type}
             and t1.member_id=#{memberId}
         </if>
         <if test="type==3">
             and t1.type=#{type}
             and t1.member_id=#{memberId}
         </if>
         <if test="type==4">
             and t1.type in(1,3)
         </if>
         <if test="type==5">
             and t1.type=2
         </if>
        order by t1.create_date desc
     </select>

    <select id="queryReturnWorkerInfo" resultType="com.dangjia.acg.dto.refund.ReturnWorkOrderDTO">
         SELECT
            t1.id repairWorkOrderId,
            t1.title_name repairWorkOrderName,
            t1.create_date applyDate,
            t1.house_id houseId,
            CONCAT(t1.content_a,t1.content_b) content,
            t1.worker_type_id workTypeId,
            t1.member_id memberId,
            t1.state,
            t2.`name` workTypeName,
            t3.worker_id workerId ,
            t4.`name` workerName,
            t4.mobile workerMobile,
            t1.sup_id supId,
            t1.type
        FROM
            dj_repair_change_order t1,
            dj_core_worker_type t2,
            dj_core_house_worker_order t3  ,
            dj_member t4
        where t1.worker_type_id=t2.id
        and t1.house_id=t3.house_id
        and t1.worker_type_id=t3.worker_type_id
        and t3.worker_id = t4.id
        and t1.id=#{repairWorkOrderId}
        and t1.data_status = '0'
     </select>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.product.IBasicsGoodsMapper">

    <sql id="all_columns">
		id,
		NAME,
		category_id as categoryId,
		type,
		buy,
		sales,
		other_name AS otherName,
		unit_id as unitId,
		create_date,
		modify_date,
		is_influe_decoration_progress as isInflueDecorationProgress,
		irreversible_reasons as irreversibleReasons,
		istop,
		brand_id as brandId,
		is_elevator_fee as isElevatorFee,
		indicative_price as indicativePrice,
		label_ids as  labelIds,
		is_reservation_deliver as isReservationDeliver
	</sql>

    <sql id="new_columns">
		id,
		NAME,
		category_id as categoryId,
		type,
		buy,
		sales,
		other_name AS otherName,
		unit_id as unitId,
		create_date,
		modify_date,
		is_influe_decoration_progress as isInflueDecorationProgress,
		irreversible_reasons as irreversibleReasons,
		istop,
		brand_id as brandId,
		is_elevator_fee as isElevatorFee,
		indicative_price as indicativePrice,
		label_ids as  labelIds,
		is_reservation_deliver as isReservationDeliver
	</sql>
    <!-- 删除对象 -->
    <delete id="deleteById" parameterType="java.lang.String">
		DELETE FROM dj_basics_goods
		WHERE id=#{id}
	</delete>
    <!-- 查询所有 -->
    <select id="query" parameterType="java.lang.String" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        <if test="category_id!=null">
            where
            category_id=#{categoryId}
        </if>
        ORDER BY create_date desc
    </select>
    <!-- 根据id查询属性对象 -->
    <select id="queryById" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        where
        id =#{id}
        ORDER BY create_date desc
    </select>

    <!-- 根据name查询属性对象 -->
    <select id="queryByName" resultType="com.dangjia.acg.modle.product.DjBasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        where data_status = 0
        AND name LIKE CONCAT('%',#{name},'%')
        ORDER BY create_date desc
    </select>


    <!-- 根据类别id查询商品对象 -->
    <select id="queryByCategoryId" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        <if test="categoryId!=null">
            where
            category_id=#{categoryId}
        </if>
        ORDER BY create_date desc
    </select>

    <!-- 根据条件查询商品集合 -->
    <select id="queryGoodsList" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        where 1=1
        <if test="categoryId!=null and categoryId!=''">
            and category_id=#{categoryId}
        </if>
        <if test="name!=null and name!=''">
            and name=#{name}
        </if>
        ORDER BY create_date desc
    </select>

    <!-- 查询某个分类的商品 模糊name -->
    <select id="queryGoodsListByCategoryLikeName" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        bg.id as id,
        bg.`NAME` as name,
        bg.category_id AS categoryId,
        bg.type as type,
        bg.buy as buy,
        bg.sales as sales,
        bg.unit_id AS unitId,
        bg.other_name AS otherName,
        bg.create_date AS createDate,
        bg.modify_date AS modifyDate
        FROM dj_basics_goods bg
        INNER JOIN dj_basics_product bp ON bp.goods_id = bg.id
        where 1=1
        <if test="categoryId!=null and categoryId!=''">
            and bg.category_id=#{categoryId}
        </if>
        <if test="name!=null and name!=''">
            AND (
            bp.`name` LIKE CONCAT('%',#{name}, '%' )
            OR bg.`other_name` LIKE CONCAT( '%', #{name}, '%' )
            )
        </if>
        GROUP BY bg.id
    </select>

    <!-- 查询某个分类的商品 模糊name -->
    <select id="queryGoodsGroupListByCategoryLikeName" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        bg.id as id,
        bg.`NAME` as name,
        bg.category_id AS categoryId,
        bg.type as type,
        bg.buy as buy,
        bg.sales as sales,
        bg.unit_id AS unitId,
        bg.other_name AS otherName,
        bg.create_date AS createDate,
        bg.modify_date AS modifyDate
        FROM dj_basics_goods bg
        INNER JOIN dj_basics_product bp ON bp.goods_id = bg.id
        where 1=1
        <if test="categoryId!=null and categoryId!=''">
            and bg.category_id=#{categoryId}
        </if>
        <if test="type!=null and type!=''">
            and bg.type =#{type}
        </if>
        <if test="buy!=null and buy!=''">
            and bg.buy !=#{buy}
        </if>
        <if test="buy!=null and buy!=''">
            and (SELECT COUNT(*) > 0 as num FROM dj_basics_product p WHERE p.goods_id = bg.id and p.type =1)
        </if>
        <if test="name!=null and name!=''">
            AND (
            bp.`name` LIKE CONCAT('%',#{name}, '%' )
            OR bg.`other_name` LIKE CONCAT( '%', #{name}, '%' )
            )
        </if>
        GROUP BY bg.id
        ORDER BY bg.create_date desc
    </select>
    <!-- 补货查询商品库- -->
    <select id="queryRepairGoods" resultType="com.dangjia.acg.modle.product.BasicsGoods">
        SELECT
        <include refid="new_columns"/>
        FROM dj_basics_goods
        WHERE
        1=1
        <if test="name!=null and name!=''">
            AND
            name LIKE CONCAT('%',#{name},'%')
        </if>
        <if test="categoryId!=null and categoryId!=''">
            AND
            category_id =#{categoryId}
        </if>
    </select>
</mapper>
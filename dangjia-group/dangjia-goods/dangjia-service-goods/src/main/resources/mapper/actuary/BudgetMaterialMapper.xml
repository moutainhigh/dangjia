<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.actuary.IBudgetMaterialMapper">

	<select id="getBudgetCaiList" resultType="com.dangjia.acg.modle.actuary.BudgetMaterial">
		SELECT
		    *
		FROM dj_actuary_budget_material
		WHERE
		   house_id=#{houseId}
		   and worker_type_id =#{workerTypeId}
		   and product_type = 0
		   and delete_state not in (1,2);
	</select>

	<select id="getBudgetSerList" resultType="com.dangjia.acg.modle.actuary.BudgetMaterial">
		SELECT
		    *
		FROM dj_actuary_budget_material
		WHERE
		   house_id=#{houseId}
		   and worker_type_id =#{workerTypeId}
		   and product_type = 1
		   and delete_state not in (1,2);
	</select>

	<sql id="all_columns">
		id,
		house_flow_id,
		house_id,
		worker_type_id,
		steta,
		template_id,
		delete_state,
		product_id,
		product_sn,
		goods_id,
		goods_name,
		product_name,
		product_nick_name,
		price,
		cost,
		description,
		shop_count,
		actuarial_quantity,
		unit,
		total_price,
		create_date,
		modify_date,
		group_type,
		product_type,
		goods_group_id
	</sql>
	<!-- 查询所有 -->
	<select id="getBudgetMaterial" resultType="java.util.Map">
		SELECT 
		    id,
			house_flow_id as houseFlowId,
			house_id as houseId,
			worker_type_id as workerTypeId,
			steta,
			template_id as templateId,
			delete_state as deleteState,
			product_id as productId,
			product_sn as productSn,
			goods_id as goodsId,
			goods_name as goodsName,
			product_name as productName,
			product_nick_name as productNickName,
			price,
			cost,
			description,
			shop_count as shopCount,
			actuarial_quantity as actuarialQuantity,
			unit,
			total_price as totalPrice,
			create_date as createDate,
			modify_date as modifyDate,
			group_type as groupType,
			product_type as productType,
			goods_group_id as goodsGroupId
		FROM dj_actuary_budget_material ORDER BY create_date desc
	</select>
	<!-- 根据houseId和wokerTypeId查询房子材料精算 -->
	<select id="getBudgetMaterialById" resultType="java.util.Map">
		SELECT 
		    id,
			house_flow_id as houseFlowId,
			house_id as houseId,
			worker_type_id as workerTypeId,
			steta,
			template_id as templateId,
			delete_state as deleteState,
			product_id as productId,
			product_sn as productSn,
			goods_id as goodsId,
			goods_name as goodsName,
			product_name as productName,
			product_nick_name as productNickName,
			price,
			cost,
			description,
			shop_count as shopCount,
			actuarial_quantity as actuarialQuantity,
			unit,
			total_price as totalPrice,
			create_date as createDate,
			modify_date as modifyDate,
			group_type as groupType,
			product_type as productType,
			goods_group_id as goodsGroupId
		FROM dj_actuary_budget_material
		where house_id=#{houseId}
		and worker_type_id =#{workerTypeId}
		ORDER BY create_date desc
	</select>
	<!-- 根据template_id查询所有 -->
	<select id="getAllbudgetTemplates" resultType="java.util.Map">
		SELECT 
			id,
			house_flow_id as houseFlowId,
			house_id as houseId,
			worker_type_id as workerTypeId,
			steta,
			template_id as templateId,
			delete_state as deleteState,
			product_id as productId,
			product_sn as productSn,
			goods_id as goodsId,
			goods_name as goodsName,
			product_name as productName,
			product_nick_name as productNickName,
			price,
			cost,
			description,
			shop_count as shopCount,
			actuarial_quantity as actuarialQuantity,
			unit,
			total_price as totalPrice,
			create_date as createDate,
			modify_date as modifyDate,
			group_type as groupType,
			product_type as productType,
			goods_group_id as goodsGroupId
		FROM dj_actuary_budget_material WHERE template_id=#{template_id} and steta=3 ORDER BY create_date desc
	</select>
	<!-- 删除对象 -->
	<delete id="deleteById" parameterType="java.lang.String">
		DELETE FROM dj_actuary_budget_material 
		WHERE id=#{id}
	</delete>
	<!-- 根据风格删除对象 -->
	<delete id="deleteBytemplateId" parameterType="java.lang.String">
		DELETE FROM dj_actuary_budget_material 
		WHERE template_id=#{template_id}
	</delete>
	<!-- 根据houseId和工种id删除人工精算 -->
	<delete id="deleteByhouseId" parameterType="java.lang.String">
		DELETE FROM dj_actuary_budget_material
		WHERE house_id=#{houseId}
		and worker_type_id =#{workerTypeId}
	</delete>
	<!--根据houseFlow查询已支付后精算价格-->
	<select id="getAbmPayOutByHfId" resultType="java.lang.Double">
		select sum(abm.price * abm.shop_count)
		from dj_actuary_budget_material abm
		WHERE abm.delete_state!=1
		and abm.steta=1
        and abm.house_flow_id=#{houseFlowId}
	</select>

	<!--根据houseFlow查询未支付实时精算价格-->
	<select id="getAbmCasualByHfId" resultType="java.lang.Double">
		select sum(p.price * abm.shop_count)
		from dj_basics_product p,dj_actuary_budget_material abm
		WHERE  p.id = abm.product_id
		and abm.delete_state!=1
		and abm.steta=1
        and abm.house_flow_id=#{houseFlowId}
	</select>
</mapper>

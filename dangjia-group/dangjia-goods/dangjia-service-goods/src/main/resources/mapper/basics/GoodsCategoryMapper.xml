<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.basics.IGoodsCategoryMapper">

	<sql id="all_columns">
		id,
		name,
		parent_id,
		parent_top,
		image,
        create_date,
        modify_date
	</sql>
	<!-- 删除对象 -->
	<delete id="deleteById" parameterType="java.lang.String">
		DELETE FROM dj_basics_goods_category 
		WHERE id=#{id}
	</delete>
    <!-- 查询所有 -->
	<select id="query" resultType="com.dangjia.acg.modle.attribute.GoodsCategory">
		SELECT
            id,
            name,
            parent_id as parentId,
            parent_top as parentTop,
            image,
            create_date as createDate,
            modify_date as modifyDate
		FROM dj_basics_goods_category
	</select>
	<!-- 批量插入数据 -->
    <insert id="insertBatch" parameterType="java.util.List" >
        insert into dj_basics_goods_category
           (<include refid="all_columns" />)
        values
        <foreach collection="list" item="goods" index="index" separator=",">
            (
              #{goods.id}, #{goods.name},#{goods.parent_id}, #{goods.parent_top}, 
              #{goods.image},SYSDATE(),SYSDATE()
            )
        </foreach>
    </insert>
    <!-- 批量更新数据 -->
    <update id="updateBatch" parameterType="java.util.List">
        update dj_basics_goods_category set
        name =
        <foreach collection="list" item="goods" index="index"
            separator=" " open="case id" close="end">
            when #{goods.id} then #{goods.name}
        </foreach>
        ,parent_id =
        <foreach collection="list" item="goods" index="index"
            separator=" " open="case id" close="end">
            when #{goods.id} then #{goods.parent_id}
        </foreach>        
        ,parent_top =
        <foreach collection="list" item="goods" index="index"
            separator=" " open="case id" close="end">
            when #{goods.id} then #{goods.parent_top}
        </foreach>
        ,image =
        <foreach collection="list" item="goods" index="index"
            separator=" " open="case id" close="end">
            when #{goods.id} then #{goods.image}
        </foreach>
        ,modify_date=SYSDATE()
        where id in
        <foreach collection="list" item="goods" index="index" 
            separator="," open="(" close=")">
             #{goods.id}
        </foreach>
    </update>

    <!-- 根据父id查询下属商品类别 -->
	<select id="queryCategoryByParentId" resultType="com.dangjia.acg.modle.attribute.GoodsCategory">
		SELECT
        id,
        name,
        parent_id as parentId,
        parent_top as parentTop,
        image,
        create_date as createDate,
        modify_date as modifyDate
		FROM dj_basics_goods_category where parent_id =#{parentId}
		ORDER BY create_date desc
	</select>
</mapper>
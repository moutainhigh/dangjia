<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dangjia.acg.mapper.engineer.DjMaintenanceManualAllocationMapper">

    <select id="searchManualAllocation" resultType="com.dangjia.acg.dto.engineer.DjMaintenanceManualAllocationDTO">
        SELECT
            t.id manuaId,
            t.create_date createDate,
            m.address,
            m.member_id memberId,
            m.`name` memeberName,
            m.mobile memeberMobile,
            t.status,
            t.money,
            t.operator_id operatorId,
            t.operator_name operatorName,
            t.maintenance_record_id maintenanceRecordId,
            t.complain_id complainId
        FROM
            dj_maintenance_manual_allocation t
        INNER JOIN dj_member_address m ON t.house_id = m.house_id
        where t.data_status='0'
        <if test="null!=manuaId and ''!=manuaId">
            AND t.id =#{manuaId}
        </if>
        <if test="null!=cityId and ''!=cityId">
            AND m.city_id =#{cityId}
        </if>
        <if test="status!=-1">
            AND t.status =#{status}
        </if>
        <if test="null!=searchKey and ''!=searchKey">
            and (m.name LIKE CONCAT('%',#{searchKey},'%')
              or m.mobile LIKE CONCAT('%',#{searchKey},'%')
              or m.address like LIKE CONCAT('%',#{searchKey},'%'))
        </if>
        order by t.create_date desc

    </select>
</mapper>
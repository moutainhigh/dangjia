<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.deliver.ISplitDeliverMapper">

    <!--授权大管家收货-->
    <update id="supState">
        update dj_deliver_split_deliver
        set supState = 1
        where id = #{splitDeliverId}
    </update>

    <select id="getWebSplitDeliverList" resultType="com.dangjia.acg.dto.finance.WebSplitDeliverItemDTO">
        SELECT
        id AS splitDeliverId,
        number AS number,
        total_amount AS totalAmount,
        apply_money AS applyMoney,
        apply_state AS applyState,
        ship_address AS shipAddress,
        supplier_id AS supplierId,
        supplier_telephone AS supMobile,
        supplier_name AS supName,
        operator_id AS operatorId,
        rec_time AS recTime,
        modify_date AS modifyDate,
        create_date AS createDate
        FROM
        dj_deliver_split_deliver
        WHERE
        data_status = 0
        and apply_state IS not NULL
        and apply_state != 3
        <if test="applyState!= -2 and applyState!= -1 ">
            and apply_state = #{applyState}
        </if>
        <if test="applyState == -2">
            and apply_state != 0
        </if>
        <if test="beginDate!=null and beginDate!='' and endDate!=null and endDate!=''">
            and modify_date between #{beginDate} and #{endDate}
        </if>
        <if test="searchKey!=null and searchKey!=''">
            and ( ship_address like CONCAT('%',#{searchKey},'%')
            or ship_mobile like CONCAT('%',#{searchKey},'%')
            or ship_name like CONCAT('%',#{searchKey},'%')
            or supplier_name like CONCAT('%',#{searchKey},'%'))
        </if>
        ORDER BY
        create_date DESC
    </select>

    <select id="getSupplierGoodsId" resultType="java.lang.String">
        SELECT
            d.supplier_id
        FROM
            `dj_deliver_order_split_item` si
        INNER JOIN dj_deliver_split_deliver d ON si.split_deliver_id = d.id
        WHERE
            si.house_id = #{houseId}
        AND si.product_sn =  #{productSn}
        ORDER BY si.create_date DESC
    </select>

</mapper>


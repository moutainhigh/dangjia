<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.member.IMemberCollectMapper">
    <sql id="basic_h_columns">
        h.id,
        h.building,
        h.city_name as cityName,
        h.residential,
        h.type,
        h.unit,
        h.member_id as memberId,
        h.task_number as taskNumber,
        h.square,
        h.number,
        h.style,
        h.designer_ok as designerOk,
        h.budget_ok as budgetOk,
        h.image,
        h.decoration_type as decorationType,
        h.city_id as cityId,
        h.modeling_layout_id as modelingLayoutId,
        h.money,
        h.pause,
        h.show_house as showHouse,
        h.village_id as villageId,
        h.refer_house_id as referHouseId,
        h.have_complete as haveComplete,
        h.record_type as recordType,
        h.build_square as buildSquare,
        h.again,
        h.house_type as houseType,
        h.drawings,
        h.work_deposit_id as workDepositId,
        h.custom_sort as customSort,
        h.is_select as isSelect,
        h.visit_state as visitState,
        h.data_status as dataStatus,
        h.create_date as createDate,
        h.construction_date as constructionDate,
        h.modify_date as modifyDate,
        h.optional_label as optionalLabel
    </sql>

    <!--房子收藏列表-->
    <select id="queryCollectHouse" resultType="com.dangjia.acg.modle.house.House">
        SELECT
        <include refid="basic_h_columns"/>
        FROM
            `dj_member_collect` c
        INNER JOIN dj_house h ON h.id = c.collect_id
        where 	c.data_status = 0 and c.condition_type = 0
        <if test="memberId!=null and memberId!=''">
            AND c.member_id = #{memberId}
        </if>
        ORDER BY c.create_date DESC
    </select>


    <select id="queryRandomProduct" resultType="com.dangjia.acg.modle.product.DjBasicsProductTemplate">
        SELECT
            bsp.id AS storefrontProductId,
            bsp.product_name AS name,
            bpt.id,
            bsp.image,
            bsp.sell_price AS price,
            bpt.unit_id AS unitId,
            bpt.unit_name AS unitName
        FROM
            dj_basics_storefront_product bsp,
            dj_basics_product_template bpt
        WHERE
            bsp.prod_template_id = bpt.id
            AND bsp.city_id = #{cityId}
        ORDER BY RAND() LIMIT #{limit}
    </select>


    <select id="queryRandomProductByCategoryId" resultType="com.dangjia.acg.modle.product.DjBasicsProductTemplate">
        SELECT
            bsp.id AS storefrontProductId,
            bsp.product_name AS name,
            bpt.id,
            bsp.image,
            bsp.sell_price AS price,
            bpt.unit_id AS unitId,
            bpt.unit_name AS unitName
        FROM
            dj_basics_storefront_product bsp,
            dj_basics_product_template bpt
        WHERE
            bsp.prod_template_id = bpt.id
        AND bpt.category_id = (
            SELECT
                t1.category_id
            FROM
                dj_basics_storefront_product t,
                dj_basics_product_template t1
            WHERE
                t.prod_template_id = t1.id
            AND t.id = #{storefrontProductId}
        )
        ORDER BY RAND() LIMIT #{limit}
    </select>

</mapper>


<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangjia.acg.mapper.core.IWorkerTypeMapper">

    <!--根据houseId查询已进场未完工工序-->
    <select id="unfinishedFlow" parameterType="java.lang.String" resultType="com.dangjia.acg.modle.core.WorkerType">
        select
            wt.id, wt.name
        from dj_core_house_flow hf,dj_core_worker_type wt
        where hf.state = 0
        and hf.work_type = 4
        and hf.work_steta != 2
        and hf.worker_type > 3
        and hf.house_id=#{houseId}
        and wt.id = hf.worker_type_id
        order by hf.sort asc
    </select>
    <select id="getName" resultType="String">
        SELECT name from dj_core_worker_type where type=#{type}
    </select>

    <!-- 根据用户id查询[所有房子][正在施工][所有工序与排期] -->
    <select id="queryWorkerTypeListByMemberId" resultType="com.dangjia.acg.modle.core.WorkerType">
        SELECT cwt.type, cwt.sort
        FROM dj_core_house_flow chf
        LEFT JOIN dj_house h ON chf.house_id = h.id
        LEFT JOIN dj_core_worker_type cwt ON chf.worker_type = cwt.type
        where h.member_id = #{memberId}
          AND chf.work_steta in (0,1,4)
    </select>

    <!-- 查询工序 根据排期 -->
    <select id="queryTypeBySort" resultType="java.lang.Integer">
        SELECT type
        FROM dj_core_worker_type
        WHERE sort in
        <foreach collection="sortList" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="querySkillCertificationSelectedList" resultType="com.dangjia.acg.modle.core.WorkerType">
        SELECT
            b.skill_pack_name
        FROM
            dj_skill_certification a
        INNER JOIN dj_core_worker_type b ON a.prod_template_id = b.id
        WHERE
            a.type = 3
        AND a.skill_certification_id=#{skillCertificationId}
    </select>

</mapper>

